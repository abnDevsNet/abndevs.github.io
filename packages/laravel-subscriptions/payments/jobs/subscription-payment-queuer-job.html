<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Subscription Payment Queuer | abnDevs</title>
    <meta name="generator" content="VuePress 1.9.8">
    
    <meta name="description" content="Build your dreams together">
    <meta name="theme-color" content="#0000FF">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.73d0500b.css" as="style"><link rel="preload" href="/assets/js/app.85871902.js" as="script"><link rel="preload" href="/assets/js/2.980f3844.js" as="script"><link rel="preload" href="/assets/js/22.71122ebd.js" as="script"><link rel="preload" href="/assets/js/3.9f4e4011.js" as="script"><link rel="prefetch" href="/assets/js/10.8b472593.js"><link rel="prefetch" href="/assets/js/11.47ab165f.js"><link rel="prefetch" href="/assets/js/12.94bb1235.js"><link rel="prefetch" href="/assets/js/13.b3e1e4f6.js"><link rel="prefetch" href="/assets/js/14.a6cd3dd4.js"><link rel="prefetch" href="/assets/js/15.4246eba7.js"><link rel="prefetch" href="/assets/js/16.65be3852.js"><link rel="prefetch" href="/assets/js/17.b368e2aa.js"><link rel="prefetch" href="/assets/js/18.46d72abf.js"><link rel="prefetch" href="/assets/js/19.332f0be1.js"><link rel="prefetch" href="/assets/js/20.8e43fa3c.js"><link rel="prefetch" href="/assets/js/21.71538835.js"><link rel="prefetch" href="/assets/js/23.0725ad15.js"><link rel="prefetch" href="/assets/js/24.366a61b0.js"><link rel="prefetch" href="/assets/js/25.3f7aaeea.js"><link rel="prefetch" href="/assets/js/4.7364160c.js"><link rel="prefetch" href="/assets/js/5.3da2d6a2.js"><link rel="prefetch" href="/assets/js/6.4d41e4ec.js"><link rel="prefetch" href="/assets/js/7.de19c5e4.js"><link rel="prefetch" href="/assets/js/8.38012b49.js"><link rel="prefetch" href="/assets/js/9.5aafaaea.js">
    <link rel="stylesheet" href="/assets/css/0.styles.73d0500b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">abnDevs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/packages/" class="nav-link router-link-active">
  Packages
</a></div> <a href="https://github.com/abnDevs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/packages/" class="nav-link router-link-active">
  Packages
</a></div> <a href="https://github.com/abnDevs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Laravel Subscriptions</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/packages/laravel-subscriptions/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/packages/laravel-subscriptions/install/" class="sidebar-link">Installation</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Models</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/packages/laravel-subscriptions/models/" class="sidebar-link">Models</a></li><li><a href="/packages/laravel-subscriptions/models/plan-model.html" class="sidebar-link">Plan Model</a></li><li><a href="/packages/laravel-subscriptions/models/plan-combination-model.html" class="sidebar-link">Plan Combination Model</a></li><li><a href="/packages/laravel-subscriptions/models/plan-feature-model.html" class="sidebar-link">Plan Feature Model</a></li><li><a href="/packages/laravel-subscriptions/models/plan-subscription-model.html" class="sidebar-link">Plan Subscription Model</a></li><li><a href="/packages/laravel-subscriptions/models/plan-subscription-feature-model.html" class="sidebar-link">Plan Subscription Feature Model</a></li><li><a href="/packages/laravel-subscriptions/models/plan-subscription-schedule-model.html" class="sidebar-link">Plan Subscription Schedule Model</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Payments</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/packages/laravel-subscriptions/payments/payment-services.html" class="sidebar-link">Payment services</a></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>Jobs</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/packages/laravel-subscriptions/payments/jobs/subscription-payment-queuer-job.html" aria-current="page" class="active sidebar-link">Subscription Payment Queuer</a></li><li><a href="/packages/laravel-subscriptions/payments/jobs/subscription-renewal-payment-job.html" class="sidebar-link">Subscription Payment</a></li><li><a href="/packages/laravel-subscriptions/payments/jobs/subscription-schedule-payment-job.html" class="sidebar-link">Subscription Schedule Payment</a></li></ul></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="subscription-payment-queuer"><a href="#subscription-payment-queuer" class="header-anchor">#</a> Subscription Payment Queuer <span class="badge tip" style="vertical-align:top;" data-v-15b7b770>new in v6.0</span></h1> <p>This is the job that needs to be called periodically to collect all the subscriptions (either renewals or schedules) that
have to be paid and process the payments.</p> <h2 id="what-it-does"><a href="#what-it-does" class="header-anchor">#</a> What it does</h2> <p>The queuer job uses the Payment Collector class. This class retrieves all pending subscription renewals and also all pending
subscription plan change schedules, then the job dispatches new jobs for each type of payment method and action needed
(renewal or schedule).</p> <h3 id="what-happens-when-subscription-schedule-is-set-at-renewal-date"><a href="#what-happens-when-subscription-schedule-is-set-at-renewal-date" class="header-anchor">#</a> What happens when subscription schedule is set at renewal date?</h3> <p>Subscription schedule change has priority over renewal, so schedule change will be first processed. Plan
change will set a new renewal time in the future, so this renewal will be pushed into the future and not processed at
the same time schedule happens to avoid duplicates.</p> <h3 id="how-does-the-package-avoid-double-charging"><a href="#how-does-the-package-avoid-double-charging" class="header-anchor">#</a> How does the package avoid double charging?</h3> <p>Both schedule and renewal jobs use Laravel's <a href="https://laravel.com/docs/8.x/queues#preventing-job-overlaps" target="_blank" rel="noopener noreferrer">Preventing Job Overlaps<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
without release, so only one job per subscription can be active.</p> <h2 id="how-to-schedule"><a href="#how-to-schedule" class="header-anchor">#</a> How to schedule</h2> <p>Your task schedule is defined in the <code>app/Console/Kernel.php</code> file's schedule method.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package"><span class="token punctuation">\</span>AbnDevs<span class="token punctuation">\</span>Subscriptions<span class="token punctuation">\</span>Jobs<span class="token punctuation">\</span>SubscriptionPaymentQueuerJob</span><span class="token punctuation">;</span>

<span class="token variable">$schedule</span><span class="token operator">-&gt;</span><span class="token function">job</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SubscriptionPaymentQueuerJob</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">everyFiveMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/packages/laravel-subscriptions/payments/payment-services.html" class="prev">
        Payment services
      </a></span> <span class="next"><a href="/packages/laravel-subscriptions/payments/jobs/subscription-renewal-payment-job.html">
        Subscription Payment
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.85871902.js" defer></script><script src="/assets/js/2.980f3844.js" defer></script><script src="/assets/js/22.71122ebd.js" defer></script><script src="/assets/js/3.9f4e4011.js" defer></script>
  </body>
</html>
